import{a as M,b as c,c as T,d as O,f as j,g as D,h as k,i as q,k as A}from"./chunk-R6PFQSX6.js";import{d as P}from"./chunk-A5CJUZX6.js";import{Da as g,Eb as I,Fa as u,Ha as l,Ia as o,Ja as p,Ka as S,La as C,M as y,Na as E,Oa as U,Qa as m,R as x,Sa as v,W as L,Ya as N,o as _,ta as d,ua as h,xb as F,zb as R}from"./chunk-4CJDLHC2.js";var b=class r{constructor(i){this.http=i}apiUser="https://task4-2d93e-default-rtdb.europe-west1.firebasedatabase.app/users.json";getUsers(){return this.http.get(this.apiUser)}loginUser(i){return this.getUsers().pipe(_(e=>{if(console.log("Fetched users:",e),!e)throw new Error("No users found in the database.");let{userName:t,password:s}=i,a;e.userName?a=[e]:a=Object.values(e),console.log("Users array:",a);let n=null;for(let f of a)if(f.userName===t&&f.password===s){n=f;break}if(console.log("Found user:",n),!n)throw new Error("Invalid user name or password");return n}))}checkUserExists(i){return this.getUsers().pipe(_(e=>e?Object.values(e).some(t=>t.userName===i):!1))}registerUser(i){return this.http.put(this.apiUser,i)}static \u0275fac=function(e){return new(e||r)(x(I))};static \u0275prov=y({token:r,factory:r.\u0275fac,providedIn:"root"})};function V(r,i){r&1&&(l(0,"div",12),m(1," Username is required. "),o())}function B(r,i){r&1&&(l(0,"div",12),m(1," Password is required. "),o())}function z(r,i){if(r&1&&(S(0),l(1,"div",6)(2,"label",7),m(3,"Username"),o(),p(4,"input",8),g(5,V,2,0,"div",9),o(),l(6,"div",6)(7,"label",10),m(8,"Password"),o(),p(9,"input",11),g(10,B,2,0,"div",9),o(),C()),r&2){let e,t,s=U();d(5),u("ngIf",((e=s.authForm.get("userName"))==null?null:e.invalid)&&((e=s.authForm.get("userName"))==null?null:e.touched)),d(5),u("ngIf",((t=s.authForm.get("password"))==null?null:t.invalid)&&((t=s.authForm.get("password"))==null?null:t.touched))}}function K(r,i){r&1&&(l(0,"div",12),m(1," User name is required. "),o())}function Q(r,i){r&1&&(l(0,"div",12),m(1," Email is required. "),o())}function W(r,i){r&1&&(l(0,"div",12),m(1," Password is required. "),o())}function X(r,i){r&1&&(l(0,"div",12),m(1," Passwords must match. "),o())}function Y(r,i){if(r&1&&(S(0),l(1,"div",6)(2,"label",13),m(3,"User Name"),o(),p(4,"input",14),g(5,K,2,0,"div",9),o(),l(6,"div",6)(7,"label",15),m(8,"User Email"),o(),p(9,"input",16),g(10,Q,2,0,"div",9),o(),l(11,"div",6)(12,"label",17),m(13,"Password"),o(),p(14,"input",18),g(15,W,2,0,"div",9),o(),l(16,"div",6)(17,"label",19),m(18,"Confirm Password"),o(),p(19,"input",20),g(20,X,2,0,"div",9),o(),C()),r&2){let e,t,s,a,n=U();d(5),u("ngIf",((e=n.authForm.get("userName"))==null?null:e.invalid)&&((e=n.authForm.get("userName"))==null?null:e.touched)),d(5),u("ngIf",((t=n.authForm.get("userEmail"))==null?null:t.invalid)&&((t=n.authForm.get("userEmail"))==null?null:t.touched)),d(5),u("ngIf",((s=n.authForm.get("password"))==null?null:s.invalid)&&((s=n.authForm.get("password"))==null?null:s.touched)),d(5),u("ngIf",((a=n.authForm.get("confirmPassword"))==null?null:a.invalid)&&((a=n.authForm.get("confirmPassword"))==null?null:a.touched))}}var G=class r{constructor(i,e,t){this.fb=i;this.userService=e;this.router=t;this.authForm=this.fb.group({userName:["",c.required],password:["",[c.required,c.minLength(6)]],confirmPassword:[""]}),this.toggleMode()}isLoginMode=!1;authForm;toggleMode(){this.isLoginMode=!this.isLoginMode,this.isLoginMode?(this.authForm.removeControl("confirmPassword"),this.authForm.removeControl("userEmail")):(this.authForm.addControl("confirmPassword",this.fb.control("",c.required)),this.authForm.addControl("userEmail",this.fb.control("",[c.required,c.email])))}onSubmit(){if(this.authForm.invalid)return;let{userName:i,password:e,confirmPassword:t,userEmail:s}=this.authForm.value;if(this.isLoginMode){let a={userName:i,password:e};this.userService.loginUser(a).subscribe(n=>{n?(console.log("Login successful",n),sessionStorage.setItem("user",JSON.stringify(n)),sessionStorage.setItem("isLogin",JSON.stringify(!0)),this.router.navigate(["/"]),setTimeout(()=>window.location.reload(),200)):alert("Invalid username or password!")},n=>console.error("Login failed",n))}else{if(e!==t){alert("Passwords do not match!");return}this.userService.checkUserExists(i).subscribe(a=>{if(a)alert("User with this username already exists!");else{let n=this.generateUserId(i),f={userName:i,password:e,email:s,isAdmin:!1,registrationDate:new Date,userId:n};this.userService.registerUser(f).subscribe(w=>{console.log("Registration successful",w),this.autoLogin(i,e)},w=>console.error("Registration failed",w))}},a=>console.error("Error checking user",a))}}generateUserId(i){let e=Date.now(),t=i.split("").reduce((s,a)=>s+a.charCodeAt(0),0);return e+t}autoLogin(i,e){this.userService.loginUser({userName:i,password:e}).subscribe(t=>{t?(console.log("Auto-login successful",t),sessionStorage.setItem("user",JSON.stringify(t)),sessionStorage.setItem("isLogin",JSON.stringify(!0)),this.router.navigate(["/"]),setTimeout(()=>window.location.reload(),200)):alert("Auto-login failed!")},t=>console.error("Auto-login error",t))}static \u0275fac=function(e){return new(e||r)(h(q),h(b),h(P))};static \u0275cmp=L({type:r,selectors:[["app-login-registration"]],standalone:!0,features:[N],decls:10,vars:7,consts:[[1,"d-flex","flex-column","align-items-center",2,"min-width","380px"],[1,"w-100","p-4","shadow-lg","rounded","bg-white",2,"max-width","400px",3,"ngSubmit","formGroup"],[1,"d-flex","justify-content-center","mb-4","text-primary"],[4,"ngIf"],["type","submit",1,"btn","btn-primary","w-100","mt-3","shadow-sm",3,"disabled"],["type","button",1,"btn","btn-outline-primary","w-100","mt-2","shadow-sm",3,"click"],[1,"form-group","mb-3"],["for","loginUserName",1,"mb-2","fw-bold"],["type","text","id","loginUserName","placeholder","Enter username","formControlName","userName",1,"form-control"],["class","text-danger small",4,"ngIf"],["for","loginPassword",1,"mb-2","fw-bold"],["type","password","id","loginPassword","placeholder","Password","formControlName","password",1,"form-control"],[1,"text-danger","small"],["for","registerUserName",1,"mb-2","fw-bold"],["type","text","id","registerUserName","placeholder","Enter your user name","formControlName","userName",1,"form-control"],["for","registerUserEmail",1,"mb-2","fw-bold"],["type","email","id","registerUserEmail","placeholder","Enter your user email","formControlName","userEmail",1,"form-control"],["for","registerPassword",1,"mb-2","fw-bold"],["type","password","id","registerPassword","placeholder","Password","formControlName","password",1,"form-control"],["for","registerConfirmPassword",1,"mb-2","fw-bold"],["type","password","id","registerConfirmPassword","placeholder","Confirm password","formControlName","confirmPassword",1,"form-control"]],template:function(e,t){e&1&&(l(0,"div",0)(1,"form",1),E("ngSubmit",function(){return t.onSubmit()}),l(2,"h4",2),m(3),o(),g(4,z,11,2,"ng-container",3)(5,Y,21,4,"ng-container",3),l(6,"button",4),m(7),o(),l(8,"button",5),E("click",function(){return t.toggleMode()}),m(9),o()()()),e&2&&(d(),u("formGroup",t.authForm),d(2),v(" ",t.isLoginMode?"Sign In":"Register"," "),d(),u("ngIf",t.isLoginMode),d(),u("ngIf",!t.isLoginMode),d(),u("disabled",t.authForm.invalid),d(),v(" ",t.isLoginMode?"Login":"Register"," "),d(2),v(" ",t.isLoginMode?"Switch to Register":"Switch to Login"," "))},dependencies:[R,F,A,j,M,T,O,D,k]})};export{G as LoginRegistrationComponent};
